import{a as R,j as e,r as n,t as E,w as S,v as O,h as i,x as V,f as d,g as D,V as h,m as q,y as m,n as P,z}from"./index-C3nUj576.js";import{C as B}from"./ConfirmPopup-DJDiep7R.js";function C(){const o=R(t=>t.teachers.teachers),x=R(t=>t.students.students);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"admin-analysis w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 shadow-[var(--box-shadow)] capitalize mb-10  p-5",children:[e.jsxs("div",{className:"item text-center",children:[e.jsx("h4",{className:"text-[#f7a163] font-bold text-2xl",children:o?.reduce((t,c)=>t+Number(c.earning||0),0)}),e.jsx("p",{className:"text-[var(--text-color)] mt-2",children:"earnings"})]}),e.jsxs("div",{className:"item text-center",children:[e.jsx("h4",{className:"text-[#eb94de] font-bold text-2xl",children:o.length}),e.jsx("p",{className:"text-[var(--text-color)] mt-2",children:"teachers"})]}),e.jsxs("div",{className:"item text-center",children:[e.jsx("h4",{className:"text-[#8c98e4] font-bold text-2xl",children:x.length}),e.jsx("p",{className:"text-[var(--text-color)] mt-2",children:"students"})]}),e.jsxs("div",{className:"item text-center",children:[e.jsx("h4",{className:"text-[#76bfa4] font-bold text-2xl",children:o?.reduce((t,c)=>t+Number(c.sessions||0),0)}),e.jsx("p",{className:"text-[var(--text-color)] mt-2",children:"sessions"})]})]})})}function H(){const[o,x]=n.useState(!1),[t,c]=n.useState(null),[u,f]=n.useState(null),g=(s,a)=>{c(s),f(a),x(!0)},j=()=>{x(!1),c(null),f(null)},[w,v]=n.useState([]),[y,N]=n.useState(null),[T,A]=n.useState(null),F=async()=>{const s=E(O(i,"newTeachers"),S("submitted","==",!0),S("approved","==",!1)),a=await V(s);v(a.docs.map(l=>({id:l.id,...l.data()})))};n.useEffect(()=>{F()},[]);const k=async s=>{try{N(s);const a=d(i,"newTeachers",s),l=d(i,"users",s),[p,b]=await Promise.all([D(a),D(l)]);if(!p.exists()||!b.exists()){h.error("Teacher data not found");return}const r=p.data(),L={Image:r.Image||"https://i.ibb.co/Kg8TGk7/user.png",name:r.name||"Unknown",subject:r.subject||"",gradeLevel:r.gradeLevel||"",certificateUrl:r.certificateUrl||"",rating:0,averageRating:null,lessonType:"Online",hourlyRate:r.hourlyRate??null,firstLessonFree:!!r.firstLessonFree,overview:r.overview||"",availableDates:Array.isArray(r.availableDates)?r.availableDates:[],availableGroupDates:Array.isArray(r.availableGroupDates)?r.availableGroupDates:[],reviews:[]};await q(d(i,"teachers",s),L),await m(l,{role:"teacher"}),await m(a,{approved:!0,approvedAt:P()}),await m(a,{approved:!0,approvedAt:P()}),h.success("Teacher approved successfully"),v(U=>U.filter(I=>I.id!==s))}catch(a){console.error(a),h.error("Approve failed")}finally{N(null)}},G=async s=>{try{A(s);const a=d(i,"newTeachers",s),l=d(i,"users",s);await z(a),await m(l,{role:"teacherRejected"}),h.success("Teacher rejected"),v(p=>p.filter(b=>b.id!==s))}catch(a){console.error(a),h.error("Reject failed")}finally{A(null)}};return w.length?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(C,{}),e.jsx("h1",{className:"text-xl font-bold mb-4",children:"Pending Teachers"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full rouded-[var(--border-radius)]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[var(--admin-bg-color)] rounded-[var(--border-radius)] text-[var(--text-color)] hidden md:table-row",children:[e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Subject"}),e.jsx("th",{children:"Grade"}),e.jsx("th",{children:"Certificate"}),e.jsx("th",{children:"Rate"}),e.jsx("th",{children:"Submitted"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:w.map(s=>e.jsxs("tr",{className:"bg-[var(--admin-even)] odd:bg-[var(--admin-odd)]  flex flex-col md:table-row mb-4",children:[e.jsx("td",{children:s.Image?e.jsx("img",{src:s.Image,alt:"",className:"w-12 h-12 rounded-full object-cover"}):"—"}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.subject||"—"}),e.jsx("td",{children:s.gradeLevel||"—"}),e.jsx("td",{children:s.certificateUrl?e.jsx("a",{href:s.certificateUrl,className:"bg-[var(--light-secondary-color)] py-2 px-2 rounded-2xl hover:bg-[var(--secondary-color)] transition duration-500",target:"_blank",rel:"noopener noreferrer",children:"View Certificate"}):"-"}),e.jsx("td",{children:s.hourlyRate??"—"}),e.jsx("td",{children:String(!!s.submitted)}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx("button",{className:"btn bg-[var(--success-color)] text-white btn-sm",onClick:()=>{g("approve",s.id)},disabled:y===s.id,children:y===s.id?e.jsx("span",{className:"loading loading-spinner loading-xs"}):"Approve"}),e.jsx("button",{className:"btn bg-[var(--error-color)] text-white btn-sm",onClick:()=>g("reject",s.id),disabled:T===s.id,children:T===s.id?e.jsx("span",{className:"loading loading-spinner loading-xs"}):"Reject"}),o&&e.jsx(B,{title:t==="approve"?"Approve Teacher":"Reject Teacher",description:t==="approve"?"Are you sure you want to approve this teacher?":"Are you sure you want to reject this teacher?",buttonTitle:t==="approve"?"Approve":"Reject",buttonFunction:t==="approve"?()=>{u&&(k(u),j())}:()=>{u&&(G(u),j())},close:j})]})]},s.id))})]})})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col ",children:[e.jsx(C,{}),e.jsxs("div",{className:"no-pending ",children:[e.jsx("h1",{className:"text-xl font-bold mb-4",children:"Pending Teachers"}),e.jsx("p",{children:"No submissions yet."})]})]})})}export{H as default};
